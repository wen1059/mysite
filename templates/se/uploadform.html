{#拖拽上传文件功能#}

<form class="mb-3" method="post" enctype="multipart/form-data" id="uploadForm">
    {% csrf_token %}
    <div id="dropZone" style="border: 2px dashed #007bff; padding: 50px; cursor: pointer;">
        拖拽文件到这里
    </div>
{#    后端通过key的value来判断对文件的操作#}
    <label for="mode"><input type="text" name="mode" id="mode" value="will_be_changed" style="display: none"></label>
    <input type="file" name="uploadfiles" id="fileInput" style="display: none;" multiple>
</form>

<script>
    // 设置 input 的 name 属性
    function setmodevalue() {
        const mode = document.getElementById('mode');
        // 根据选择的模式设置 name 属性
        mode.value = document.getElementById('modeSelect').value;
    }

    // 文件拖拽框
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');

    // 点击拖拽区域时，模拟点击文件输入元素
    dropZone.addEventListener('click', () => {
        fileInput.click();
    });
    // 处理文件选择对话框中的文件
    fileInput.addEventListener('change', () => {
        setmodevalue(); // 设置 input 的 name
        showprogress()
        document.getElementById('uploadForm').submit(); // 提交表单
    });

    // 当文件被拖拽到拖拽区域上方时，防止默认行为并改变背景色
    dropZone.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropZone.style.backgroundColor = '#e9ecef';
    });
    // 当文件离开拖拽区域时，恢复背景色
    dropZone.addEventListener('dragleave', (event) => {
        event.preventDefault();
        dropZone.style.backgroundColor = '';
    });
    // 当文件被释放到拖拽区域时，处理文件上传
    dropZone.addEventListener('drop', (event) => {
        event.preventDefault(); // 阻止默认提交行为
        fileInput.files = event.dataTransfer.files;
        setmodevalue(); // 设置 input 的 name
        showprogress()
        document.getElementById('uploadForm').submit(); // 提交表单
    });
</script>
